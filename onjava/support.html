<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê³ ê°ì„¼í„°</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="support.css" />
  <script src="script.js"></script>
</head>
<body>
  <header>
    <h1 onclick="location.href='homepage.html'">ì˜¨ì „ JAVA</h1>
    <nav>
      <ul>
        <li><a href="https://sturdy-fortnight-576x9jp9xjw3v66w-5000.app.github.dev">í¸ì˜ì  í–‰ì‚¬ëª©ë¡</a></li>
        <li><a href="martFlyers.html">ë§ˆíŠ¸ ì „ë‹¨ì§€</a></li>
        <li><a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
        <li><a href="support.html">ê³ ê°ì„¼í„°</a></li>
      </ul>
    </nav>
    <div class="login">
      <button id="loginBtn" onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
      <div id="userIcon" class="user-icon" style="display: none;" onclick="toggleNav()">ğŸ‘¤</div>
    </div>
  </header>

  <aside id="navMenu" class="nav-menu">
    <button class="close-btn" onclick="toggleNav()">Ã—</button>
    <ul>
      <li><a href="mypage.html">ë§ˆì´í˜ì´ì§€</a></li>
      <li><a href="#">ì„¤ì •</a></li>
      <li><a href="logout.php">ë¡œê·¸ì•„ì›ƒ</a></li>
    </ul>
  </aside>

  <main class="support-main">
    <div class="support-tabs">
      <div class="tab-buttons">
        <button id="noticeTab" class="active" onclick="changeTab('notice')">ê³µì§€ì‚¬í•­</button>
        <button id="inquiryTab" onclick="changeTab('inquiry')">ë¬¸ì˜í•˜ê¸°</button>
      </div>
      <button id="writeBtn" class="write-btn" style="display: none;">ê¸€ì“°ê¸°</button>
    </div>

    <table class="support-table">
      <thead>
        <tr>
          <th>ì œëª©</th>
          <th>ì‘ì„±ì</th>
          <th>ì‘ì„±ì¼</th>
          <th>ì¡°íšŒìˆ˜</th>
          <th id="statusHeader" style="display: none;">ì§„í–‰ ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="supportList">
        <!-- ëª©ë¡ ë°ì´í„° ì‚½ì… -->
      </tbody>
    </table>
  </main>

  <footer>
    <p>Â© 2025 ì˜¨ì „ JAVA</p>
  </footer>

  <script>
    let currentTab = 'notice';
    let userType = null;

    fetch('session_check.php')
      .then(res => res.json())
      .then(data => {
        if (data.loggedIn) {
          document.getElementById('loginBtn').style.display = 'none';
          document.getElementById('userIcon').style.display = 'block';
          userType = data.userType;
          updateWriteBtn();
        }
      });

    function updateWriteBtn() {
      const writeBtn = document.getElementById('writeBtn');
      if ((currentTab === 'notice' && userType === 'admin') ||
          (currentTab === 'inquiry' && (userType === 'user' || userType === 'seller'))) {
        writeBtn.style.display = 'inline-block';
        writeBtn.onclick = () => {
          const page = currentTab === 'notice' ? 'write_notice.html' : 'write_inquiry.html';
          location.href = page;
        };
      } else {
        writeBtn.style.display = 'none';
      }
    }

    function changeTab(tab) {
      currentTab = tab;
      document.getElementById('noticeTab').classList.remove('active');
      document.getElementById('inquiryTab').classList.remove('active');
      document.getElementById(tab + 'Tab').classList.add('active');

      // ìƒíƒœ ì»¬ëŸ¼ í‘œì‹œ ì—¬ë¶€
      document.getElementById('statusHeader').style.display = tab === 'inquiry' ? 'table-cell' : 'none';

      updateWriteBtn();
      loadPosts();
    }

    function loadPosts() {
      fetch(`fetch_support_posts.php?type=${currentTab}`)
        .then(res => res.json())
        .then(posts => {
          const tbody = document.getElementById('supportList');
          tbody.innerHTML = '';
          posts.forEach(post => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><a href="view_${currentTab}.html?id=${post.id}">${post.title}</a></td>
              <td>${post.nickname}</td>
              <td>${post.created_at}</td>
              <td>${post.views}</td>
              ${currentTab === 'inquiry' ? `<td>${post.status}</td>` : ''}
            `;
            tbody.appendChild(tr);
          });
        });
    }

    // ìµœì´ˆ ë¡œë“œ
    window.addEventListener('DOMContentLoaded', () => {
      loadPosts();
    });
  </script>
</body>
</html>