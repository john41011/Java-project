<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ë„ ë””ë²„ê¹… - í¸ì˜ì  í–‰ì‚¬ìƒí’ˆ ëª¨ìŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .debug-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        
        #map {
            width: 100%;
            height: 400px;
            border: 2px solid #007bff;
            border-radius: 10px;
            background-color: #f8f9fa;
        }
        
        .test-button {
            margin: 5px;
            padding: 8px 15px;
        }
        
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .status.success { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.warning { background-color: #fff3cd; color: #856404; }
        .status.info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>ğŸ”§ ì§€ë„ ë””ë²„ê¹… í˜ì´ì§€</h1>
        
        <!-- ìƒíƒœ í‘œì‹œ -->
        <div id="status-container"></div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
        <div class="mb-3">
            <button onclick="testKakaoAPI()" class="btn btn-primary test-button">1. Kakao API í…ŒìŠ¤íŠ¸</button>
            <button onclick="testMapContainer()" class="btn btn-secondary test-button">2. ì§€ë„ ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testMapInit()" class="btn btn-success test-button">3. ì§€ë„ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸</button>
            <button onclick="testGeocoder()" class="btn btn-warning test-button">4. ì§€ì˜¤ì½”ë” í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearLogs()" class="btn btn-danger test-button">ë¡œê·¸ ì´ˆê¸°í™”</button>
        </div>
        
        <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
        <div id="map"></div>
        
        <!-- ë””ë²„ê·¸ ì •ë³´ -->
        <div class="debug-info mt-3">
            <h5>ğŸ› ë””ë²„ê·¸ ë¡œê·¸:</h5>
            <div id="debug-log"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b285181ca1075385cd0fed595ae04444&libraries=services"></script>
    
    <script>
        let map;
        let geocoder;
        
        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('debug-log');
            const statusContainer = document.getElementById('status-container');
            
            // ë””ë²„ê·¸ ë¡œê·¸ì— ì¶”ê°€
            logContainer.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // ìƒíƒœ í‘œì‹œ
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusContainer.appendChild(statusDiv);
            
            // ì½˜ì†”ì—ë„ ì¶œë ¥
            console.log(`[${timestamp}] ${message}`);
        }
        
        // ë¡œê·¸ ì´ˆê¸°í™”
        function clearLogs() {
            document.getElementById('debug-log').innerHTML = '';
            document.getElementById('status-container').innerHTML = '';
            console.clear();
            addLog('ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        // 1. Kakao API í…ŒìŠ¤íŠ¸
        function testKakaoAPI() {
            addLog('=== Kakao API í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            if (typeof kakao === 'undefined') {
                addLog('âŒ Kakao ê°ì²´ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
                return false;
            }
            addLog('âœ… Kakao ê°ì²´ ë¡œë“œë¨', 'success');
            
            if (typeof kakao.maps === 'undefined') {
                addLog('âŒ kakao.mapsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
                return false;
            }
            addLog('âœ… kakao.maps ë¡œë“œë¨', 'success');
            
            if (typeof kakao.maps.services === 'undefined') {
                addLog('âŒ kakao.maps.servicesê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
                return false;
            }
            addLog('âœ… kakao.maps.services ë¡œë“œë¨', 'success');
            
            addLog('ğŸ‰ Kakao API ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!', 'success');
            return true;
        }
        
        // 2. ì§€ë„ ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸
        function testMapContainer() {
            addLog('=== ì§€ë„ ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            const container = document.getElementById('map');
            if (!container) {
                addLog('âŒ ì§€ë„ ì»¨í…Œì´ë„ˆ(#map)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return false;
            }
            addLog('âœ… ì§€ë„ ì»¨í…Œì´ë„ˆ ì°¾ìŒ', 'success');
            
            const rect = container.getBoundingClientRect();
            addLog(`ğŸ“ ì»¨í…Œì´ë„ˆ í¬ê¸°: ${rect.width}x${rect.height}`, 'info');
            
            if (rect.width === 0 || rect.height === 0) {
                addLog('âŒ ì§€ë„ ì»¨í…Œì´ë„ˆ í¬ê¸°ê°€ 0ì…ë‹ˆë‹¤!', 'error');
                return false;
            }
            addLog('âœ… ì§€ë„ ì»¨í…Œì´ë„ˆ í¬ê¸° ì •ìƒ', 'success');
            
            return true;
        }
        
        // 3. ì§€ë„ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸
        function testMapInit() {
            addLog('=== ì§€ë„ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            if (!testKakaoAPI() || !testMapContainer()) {
                addLog('âŒ ì„ í–‰ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ë¡œ ì§€ë„ ì´ˆê¸°í™” ì¤‘ë‹¨', 'error');
                return false;
            }
            
            try {
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng(37.566826, 126.9786567),
                    level: 5
                };
                
                addLog('ğŸ”„ ì§€ë„ ê°ì²´ ìƒì„± ì¤‘...', 'warning');
                map = new kakao.maps.Map(container, options);
                addLog('âœ… ì§€ë„ ê°ì²´ ìƒì„± ì„±ê³µ!', 'success');
                
                // ì§€ë„ ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'tilesloaded', function() {
                    addLog('âœ… ì§€ë„ íƒ€ì¼ ë¡œë”© ì™„ë£Œ!', 'success');
                });
                
                return true;
            } catch (error) {
                addLog(`âŒ ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                return false;
            }
        }
        
        // 4. ì§€ì˜¤ì½”ë” í…ŒìŠ¤íŠ¸
        function testGeocoder() {
            addLog('=== ì§€ì˜¤ì½”ë” í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            if (!map) {
                addLog('âŒ ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ. ë¨¼ì € ì§€ë„ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.', 'error');
                return false;
            }
            
            try {
                geocoder = new kakao.maps.services.Geocoder();
                addLog('âœ… ì§€ì˜¤ì½”ë” ìƒì„± ì„±ê³µ', 'success');
                
                // í…ŒìŠ¤íŠ¸ ì£¼ì†Œ ê²€ìƒ‰
                addLog('ğŸ”„ í…ŒìŠ¤íŠ¸ ì£¼ì†Œ ê²€ìƒ‰ ì¤‘... (ì„œìš¸ì‹œì²­)', 'warning');
                geocoder.addressSearch('ì„œìš¸ì‹œì²­', function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        addLog('âœ… ì£¼ì†Œ ê²€ìƒ‰ ì„±ê³µ!', 'success');
                        addLog(`ğŸ“ ê²€ìƒ‰ ê²°ê³¼: ${result[0].address_name}`, 'info');
                        
                        // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                        const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        map.setCenter(coords);
                        
                        // ë§ˆì»¤ ì¶”ê°€
                        const marker = new kakao.maps.Marker({
                            position: coords,
                            map: map
                        });
                        
                        addLog('âœ… ì§€ë„ ì¤‘ì‹¬ ì´ë™ ë° ë§ˆì»¤ ì¶”ê°€ ì™„ë£Œ', 'success');
                    } else {
                        addLog(`âŒ ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨: ${status}`, 'error');
                    }
                });
                
                return true;
            } catch (error) {
                addLog(`âŒ ì§€ì˜¤ì½”ë” ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                return false;
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            addLog('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
            
            // 1ì´ˆ í›„ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(() => {
                addLog('ğŸ”„ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...', 'warning');
                
                if (testKakaoAPI()) {
                    setTimeout(() => {
                        if (testMapContainer()) {
                            setTimeout(() => {
                                testMapInit();
                            }, 500);
                        }
                    }, 500);
                }
            }, 1000);
        };
        
        // ì—ëŸ¬ ìºì¹˜
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            addLog(`âŒ JavaScript ì˜¤ë¥˜: ${msg} (Line: ${lineNo})`, 'error');
            return false;
        };
    </script>
</body>
</html>